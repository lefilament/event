<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- Registration template -->
    <template
        id="registration_template"
        inherit_id="website_event.registration_template"
        name="Events Registration Ticket Limit"
    >
        <!-- Multi tickets option -->
        <xpath
            expr="//div[@id='o_wevent_tickets_collapse']/div/div/div/select"
            position="attributes"
        >
            <attribute
                name="t-if"
            >not ticket.is_expired and ticket.sale_available and ticket.max_ticket &lt; 1</attribute>
        </xpath>
        <xpath
            expr="//div[@id='o_wevent_tickets_collapse']/div/div/div/select"
            position="after"
        >
            <select
                t-elif="not ticket.is_expired and ticket.sale_available and ticket.max_ticket &gt;= 1"
                t-attf-name="nb_register-#{ticket.id}"
                class="form-select"
            >
                <t
                    t-set="seats_max_ticket"
                    t-value="(not ticket.seats_limited or ticket.seats_available &gt; 9) and 10 or ticket.seats_available + 1"
                />
                <t
                    t-set="seats_max_event"
                    t-value="(not event.seats_limited or event.seats_available &gt; 9) and 10 or event.seats_available + 1"
                />
                <t
                    t-set="seats_max"
                    t-value="min(seats_max_ticket, seats_max_event, ticket.max_ticket)"
                />
                <t t-foreach="range(0, seats_max)" t-as="nb">
                    <option
                        t-out="nb"
                        t-att-selected="len(ticket) == 0 and nb == 0 and 'selected'"
                    />
                </t>
            </select>
        </xpath>

        <!-- Single ticket -->
        <xpath
            expr="//div[hasclass('o_wevent_registration_single')]/div/div/div/t/select"
            position="before"
        >
            <t t-set="max_ticket" t-value="tickets.max_ticket if tickets else 0" />
        </xpath>
        <xpath
            expr="//div[hasclass('o_wevent_registration_single')]/div/div/div/t/select"
            position="attributes"
        >
            <attribute name="t-if">max_ticket &lt; 1</attribute>
        </xpath>
        <xpath
            expr="//div[hasclass('o_wevent_registration_single')]/div/div/div/t/select"
            position="after"
        >
            <select
                t-elif="max_ticket &gt; 1"
                t-att-name="'nb_register-%s' % (tickets.id if tickets else 0)"
                class="d-inline w-auto form-select"
            >
                <t
                    t-set="seats_max_ticket"
                    t-value="(not tickets or not tickets.seats_limited or tickets.seats_available &gt; 9) and 10 or tickets.seats_available + 1"
                />
                <t
                    t-set="seats_max_event"
                    t-value="(not event.seats_limited or event.seats_available &gt; 9) and 10 or event.seats_available + 1"
                />
                <t
                    t-set="seats_max"
                    t-value="min(seats_max_ticket, seats_max_event, max_ticket + 1) if tickets else seats_max_event"
                />
                <t t-foreach="range(0, seats_max)" t-as="nb">
                    <option t-out="nb" t-att-selected="nb == 1 and 'selected'" />
                </t>
            </select>
        </xpath>
    </template>
</odoo>
